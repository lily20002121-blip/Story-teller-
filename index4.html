<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story Teller - Cinematic Edition</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a cinematic feel -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=Noto+Sans+Myanmar:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans Myanmar', 'Merriweather', serif;
            background: radial-gradient(circle at top, #1a1a1a 0%, #000000 100%);
            color: #e5e5e5;
            min-height: 100vh;
        }
        .story-text {
            font-family: 'Merriweather', 'Noto Sans Myanmar', serif;
            line-height: 2.2;
            font-size: 1.125rem;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #111; 
        }
        ::-webkit-scrollbar-thumb {
            background: #444; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #ff4b4b; 
        }
        .loader {
            border: 3px solid #333;
            border-top: 3px solid #ff4b4b;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased flex flex-col items-center justify-start pt-10 px-4 pb-20">

    <div class="w-full max-w-3xl flex flex-col items-center">
        
        <!-- Header Section -->
        <div class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-[#ff4b4b] mb-4 tracking-wide font-serif">
                üìñ Story Teller
            </h1>
            <p class="text-gray-400 text-lg">·ÄÖ·Ä¨·Äê·ÄÖ·Ä∫·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äõ·Ä±·Ä∏·Äï·Ä´ ‚Äî Novel ·Äï·ÄØ·Ä∂·ÄÖ·Ä∂ storytelling ·Ä°·Äï·Äº·Ää·Ä∑·Ä∫·Ä°·ÄÖ·ÄØ·Ä∂·Äõ·Ä±·Ä∏·Äï·Ä±·Ä∏·Äô·Äö·Ä∫</p>
        </div>

        <!-- Input Section -->
        <div class="w-full bg-[#151515] p-6 rounded-2xl shadow-2xl border border-gray-800 relative z-10">
            <textarea 
                id="prompt" 
                class="w-full h-32 p-4 bg-[#0a0a0a] border border-gray-700 rounded-xl text-gray-200 placeholder-gray-600 focus:outline-none focus:border-[#ff4b4b] focus:ring-1 focus:ring-[#ff4b4b] transition-colors resize-none text-lg"
                placeholder="·Ä•·Äï·Äô·Ä¨ - Nike ·Äõ·Ä≤·Ä∑·Ä°·ÄÖ·Äá·Ä¨·Äê·Ä∫·Äú·Äô·Ä∫·Ä∏·ÄÄ·Ä≠·ÄØ ·ÄÖ·Ä≠·Äê·Ä∫·Äù·ÄÑ·Ä∫·ÄÖ·Ä¨·Ä∏·Äñ·ÄΩ·Äö·Ä∫·Äï·Äº·Ä±·Ä¨·Äï·Äº·Äï·Ä´"
            ></textarea>
            
            <!-- Error Message Box -->
            <div id="error-box" class="hidden mt-3 text-red-400 text-sm bg-red-900/20 px-4 py-2 rounded-lg border border-red-900/50">
                <!-- Error text will appear here -->
            </div>

            <div class="mt-4 flex justify-end">
                <button 
                    id="generate-btn"
                    onclick="generateStory()" 
                    class="bg-[#ff4b4b] hover:bg-[#ff1f1f] text-white font-semibold py-3 px-8 rounded-xl transition-all transform hover:scale-105 shadow-[0_0_15px_rgba(255,75,75,0.3)] flex items-center justify-center min-w-[160px]"
                >
                    <span id="btn-text">Create Story</span>
                    <div id="btn-loader" class="loader hidden"></div>
                </button>
            </div>
        </div>

        <!-- Result Section -->
        <div id="result-container" class="w-full mt-10 hidden opacity-0 transition-opacity duration-1000">
            <div class="bg-[#111] p-8 md:p-12 rounded-2xl shadow-2xl border border-gray-800">
                <div id="result" class="story-text text-gray-300 whitespace-pre-wrap"></div>
            </div>
            
            <div class="text-center mt-8 text-sm text-gray-600 tracking-widest uppercase">
                Cinematic Story Mode
            </div>
        </div>

    </div>

    <script>
        // API Key will be injected by the environment
        const apiKey = "";

        // Elements
        const promptInput = document.getElementById("prompt");
        const generateBtn = document.getElementById("generate-btn");
        const btnText = document.getElementById("btn-text");
        const btnLoader = document.getElementById("btn-loader");
        const resultContainer = document.getElementById("result-container");
        const resultDiv = document.getElementById("result");
        const errorBox = document.getElementById("error-box");

        function showError(msg) {
            errorBox.textContent = msg;
            errorBox.classList.remove("hidden");
        }

        function hideError() {
            errorBox.classList.add("hidden");
            errorBox.textContent = "";
        }

        function setLoading(isLoading) {
            if (isLoading) {
                btnText.textContent = "·Äõ·Ä±·Ä∏·Äû·Ä¨·Ä∏·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫...";
                btnLoader.classList.remove("hidden");
                generateBtn.disabled = true;
                generateBtn.classList.add("opacity-75", "cursor-not-allowed");
            } else {
                btnText.textContent = "Create Story";
                btnLoader.classList.add("hidden");
                generateBtn.disabled = false;
                generateBtn.classList.remove("opacity-75", "cursor-not-allowed");
            }
        }

        // Exponential Backoff implementation for fetch
        async function fetchWithRetry(url, options, maxRetries = 5) {
            const delays = [1000, 2000, 4000, 8000, 16000];
            
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return await response.json();
                } catch (error) {
                    if (i === maxRetries - 1) {
                        throw error; // Throw error on final attempt
                    }
                    // Wait for the specified delay before retrying
                    await new Promise(resolve => setTimeout(resolve, delays[i]));
                }
            }
        }

        async function generateStory() {
            const prompt = promptInput.value.trim();
            hideError();

            if (!prompt) {
                showError("·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äï·Äº·ÄØ·Åç ·Äá·Ä¨·Äê·Ä∫·Äú·Äô·Ä∫·Ä∏·Ä°·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Ä°·Äõ·Ä¨·ÄÄ·Ä≠·ÄØ ·Äõ·Ä±·Ä∏·Äû·Ä¨·Ä∏·Äï·Ä±·Ä∏·Äï·Ä´·Åã");
                promptInput.focus();
                return;
            }

            // UI Updates for loading state
            setLoading(true);
            resultContainer.classList.remove("hidden");
            resultContainer.classList.remove("opacity-100");
            resultContainer.classList.add("opacity-0");
            
            // Allow DOM to update before heavy processing
            await new Promise(r => setTimeout(r, 100));

            const systemInstruction = `
You are a master novelist and cinematic storyteller.

Rules:
- Always write in Myanmar language.
- Do NOT write in script/dialogue format.
- Write in full novel storytelling style.
- Make it emotional, vivid, and immersive.
- Use scene descriptions and strong opening hook.
- Structure:
    1. Powerful Opening
    2. Background
    3. Rising Conflict or Struggle
    4. Turning Point
    5. Emotional Conclusion
- Minimum 900+ words.
`;

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{
                    parts: [{
                        text: prompt
                    }]
                }],
                systemInstruction: {
                    parts: [{
                        text: systemInstruction
                    }]
                }
            };

            try {
                const data = await fetchWithRetry(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(payload)
                });

                if (data && data.candidates && data.candidates.length > 0) {
                    const story = data.candidates[0].content.parts[0].text;
                    resultDiv.innerHTML = story;
                    
                    // Fade in the result
                    resultContainer.classList.remove("opacity-0");
                    resultContainer.classList.add("opacity-100");
                    
                    // Scroll to result smoothly
                    resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                    throw new Error("No story generated");
                }
            } catch (error) {
                showError("·Äá·Ä¨·Äê·Ä∫·Äú·Äô·Ä∫·Ä∏·Äõ·Ä±·Ä∏·Äõ·Ä¨·Äê·ÄΩ·ÄÑ·Ä∫ ·Ä°·Äô·Äæ·Ä¨·Ä∏·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ·Äñ·Äº·ÄÖ·Ä∫·Äï·ÄΩ·Ä¨·Ä∏·ÄÅ·Ä≤·Ä∑·Äû·Ää·Ä∫·Åã ·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äï·Äº·ÄØ·Åç ·ÄÅ·Ä±·Äê·Äπ·Äê·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄÆ·Ä∏ ·Äï·Äº·Äî·Ä∫·Äú·Ää·Ä∫·ÄÄ·Äº·Ä≠·ÄØ·Ä∏·ÄÖ·Ä¨·Ä∏·ÄÄ·Äº·Ää·Ä∑·Ä∫·Äï·Ä´·Åã");
                resultContainer.classList.add("hidden");
            } finally {
                setLoading(false);
            }
        }
    </script>
</body>
</html>

